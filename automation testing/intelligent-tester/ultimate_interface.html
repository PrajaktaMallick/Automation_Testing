<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ Intelligent Web Tester - Complete Project</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            border-radius: 12px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
        }
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .progress-bar {
            width: 100%;
            background-color: #e5e7eb;
            border-radius: 12px;
            height: 12px;
            overflow: hidden;
        }
        .progress-fill {
            height: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            transition: width 0.5s ease;
        }
        .action-item {
            transition: all 0.4s ease;
            border-radius: 12px;
        }
        .action-item.executing {
            background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
            border-left: 6px solid #3b82f6;
            transform: scale(1.02);
        }
        .action-item.completed {
            background: linear-gradient(135deg, #dcfce7 0%, #f0fdf4 100%);
            border-left: 6px solid #10b981;
        }
        .action-item.failed {
            background: linear-gradient(135deg, #fee2e2 0%, #fef2f2 100%);
            border-left: 6px solid #ef4444;
        }
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .7; }
        }
        .glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        .hero-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-blue-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white p-8">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-16 h-16 bg-white bg-opacity-20 rounded-2xl flex items-center justify-center text-3xl">
                        ü§ñ
                    </div>
                    <div>
                        <h1 class="text-4xl font-bold">Intelligent Web Tester</h1>
                        <p class="text-blue-100 text-lg">Complete AI-Powered Automation Project</p>
                    </div>
                </div>
                <div id="connectionStatus" class="flex items-center space-x-3 bg-white bg-opacity-20 rounded-xl px-4 py-2">
                    <div class="w-4 h-4 bg-yellow-400 rounded-full animate-pulse"></div>
                    <span class="text-sm font-medium">Connecting...</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="py-16">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <div class="mb-12">
                <div class="text-8xl mb-6">üöÄ</div>
                <h2 class="text-5xl font-bold hero-text mb-6">Complete Project Running</h2>
                <p class="text-xl text-gray-600 max-w-4xl mx-auto leading-relaxed">
                    Transform natural language into intelligent browser automation. Watch as AI converts your 
                    plain English commands into sophisticated test sequences with real browser execution.
                </p>
            </div>
            
            <!-- Project Status -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12">
                <div class="card bg-gradient-to-br from-green-50 to-emerald-100 border-2 border-green-200">
                    <div class="text-3xl mb-3">‚úÖ</div>
                    <div class="font-bold text-green-900 text-lg">Backend Server</div>
                    <div class="text-green-700 text-sm">Running & Ready</div>
                </div>
                <div class="card bg-gradient-to-br from-blue-50 to-indigo-100 border-2 border-blue-200">
                    <div class="text-3xl mb-3">üß†</div>
                    <div class="font-bold text-blue-900 text-lg">AI Engine</div>
                    <div class="text-blue-700 text-sm">Intelligent Planning</div>
                </div>
                <div class="card bg-gradient-to-br from-purple-50 to-violet-100 border-2 border-purple-200">
                    <div class="text-3xl mb-3">üåê</div>
                    <div class="font-bold text-purple-900 text-lg">Browser Engine</div>
                    <div class="text-purple-700 text-sm">Real Automation</div>
                </div>
                <div class="card bg-gradient-to-br from-orange-50 to-amber-100 border-2 border-orange-200">
                    <div class="text-3xl mb-3">üìä</div>
                    <div class="font-bold text-orange-900 text-lg">Live Monitoring</div>
                    <div class="text-orange-700 text-sm">Real-time Tracking</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Interface -->
    <main class="max-w-7xl mx-auto px-6 pb-16">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Test Creator -->
            <div class="lg:col-span-2">
                <div class="card glow">
                    <h3 class="text-3xl font-bold text-gray-900 mb-8 flex items-center">
                        üéØ Create Intelligent Test
                    </h3>
                    
                    <form id="testForm" class="space-y-8">
                        <!-- Website URL -->
                        <div>
                            <label class="block text-lg font-semibold text-gray-700 mb-3">
                                üåê Target Website URL *
                            </label>
                            <input 
                                type="url" 
                                id="websiteUrl"
                                class="w-full px-6 py-4 border-2 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-500 focus:border-blue-500 text-lg transition-all"
                                placeholder="https://example.com"
                                value="https://example.com"
                                required
                            >
                            <p class="text-sm text-gray-500 mt-2 flex items-center">
                                <span class="mr-2">üí°</span>
                                The browser will actually navigate to this website and perform your actions
                            </p>
                        </div>

                        <!-- Test Prompt -->
                        <div>
                            <label class="block text-lg font-semibold text-gray-700 mb-3">
                                üó£Ô∏è Describe Your Test in Natural Language *
                            </label>
                            <textarea 
                                id="testPrompt"
                                rows="6"
                                class="w-full px-6 py-4 border-2 border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-500 focus:border-blue-500 text-lg transition-all"
                                placeholder="Navigate to the website, take a screenshot, and verify the page title contains 'Example'"
                                required
                            >Navigate to the website, take a screenshot, and verify the page title contains "Example"</textarea>
                            <p class="text-sm text-gray-500 mt-2 flex items-center">
                                <span class="mr-2">üß†</span>
                                AI will analyze your prompt and create a detailed action plan with real browser execution
                            </p>
                        </div>

                        <!-- Submit Button -->
                        <div class="text-center">
                            <button type="submit" id="submitBtn" class="btn-primary flex items-center space-x-4 mx-auto text-xl px-12 py-6 glow">
                                <span id="submitText">üöÄ Launch Intelligent Test</span>
                                <div id="submitSpinner" class="spinner hidden"></div>
                            </button>
                            <p class="text-sm text-gray-500 mt-4">
                                üéØ Your browser will open and perform the actions automatically
                            </p>
                        </div>
                    </form>
                </div>

                <!-- Action Plan Display -->
                <div id="actionPlanSection" class="card mt-8 hidden">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6">üìã AI-Generated Action Plan</h3>
                    <div id="actionPlanContent"></div>
                </div>

                <!-- Execution Status -->
                <div id="executionSection" class="card mt-8 hidden">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6">‚ö° Live Execution Monitor</h3>
                    <div id="executionContent"></div>
                </div>

                <!-- Results Section -->
                <div id="resultsSection" class="card mt-8 hidden">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6">üéâ Test Results</h3>
                    <div id="resultsContent"></div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-8">
                <!-- Quick Examples -->
                <div class="card">
                    <h4 class="text-xl font-bold text-gray-900 mb-6">‚ö° Quick Test Examples</h4>
                    <div class="space-y-4">
                        <button class="example-btn w-full text-left p-6 bg-gradient-to-r from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 rounded-xl border-2 border-blue-200 transition-all transform hover:scale-105"
                                data-url="https://example.com"
                                data-prompt="Navigate to the website, take a screenshot, and verify the page title contains 'Example'">
                            <div class="font-bold text-blue-900 text-lg mb-2">üåê Simple Navigation</div>
                            <div class="text-blue-700 text-sm">Basic website visit and verification</div>
                        </button>
                        
                        <button class="example-btn w-full text-left p-6 bg-gradient-to-r from-green-50 to-green-100 hover:from-green-100 hover:to-green-200 rounded-xl border-2 border-green-200 transition-all transform hover:scale-105"
                                data-url="https://httpbin.org/forms/post"
                                data-prompt="Fill out the form with name 'John Doe' and email 'john@example.com' then submit">
                            <div class="font-bold text-green-900 text-lg mb-2">üìù Form Testing</div>
                            <div class="text-green-700 text-sm">Automated form filling and submission</div>
                        </button>
                        
                        <button class="example-btn w-full text-left p-6 bg-gradient-to-r from-purple-50 to-purple-100 hover:from-purple-100 hover:to-purple-200 rounded-xl border-2 border-purple-200 transition-all transform hover:scale-105"
                                data-url="https://github.com"
                                data-prompt="Search for 'playwright' and click on the first repository result">
                            <div class="font-bold text-purple-900 text-lg mb-2">üîç Search Testing</div>
                            <div class="text-purple-700 text-sm">Search functionality and result interaction</div>
                        </button>
                    </div>
                </div>

                <!-- System Status -->
                <div class="card">
                    <h4 class="text-xl font-bold text-gray-900 mb-6">üîß System Status</h4>
                    <div id="systemStatus" class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium text-gray-700">Backend API</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse"></div>
                                <span class="text-sm text-yellow-600 font-medium">Checking...</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium text-gray-700">AI Engine</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse"></div>
                                <span class="text-sm text-yellow-600 font-medium">Checking...</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium text-gray-700">Browser Engine</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse"></div>
                                <span class="text-sm text-yellow-600 font-medium">Checking...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Project Info -->
                <div class="card bg-gradient-to-br from-indigo-50 to-purple-50 border-2 border-indigo-200">
                    <h4 class="text-xl font-bold text-indigo-900 mb-6">üöÄ Project Features</h4>
                    <div class="space-y-3 text-sm text-indigo-700">
                        <div class="flex items-center space-x-3">
                            <div class="w-2 h-2 bg-indigo-500 rounded-full"></div>
                            <span>Natural Language Processing</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="w-2 h-2 bg-indigo-500 rounded-full"></div>
                            <span>Real Browser Automation</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="w-2 h-2 bg-indigo-500 rounded-full"></div>
                            <span>Intelligent Element Detection</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="w-2 h-2 bg-indigo-500 rounded-full"></div>
                            <span>Live Execution Monitoring</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="w-2 h-2 bg-indigo-500 rounded-full"></div>
                            <span>Visual Documentation</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="w-2 h-2 bg-indigo-500 rounded-full"></div>
                            <span>Complete Test Reports</span>
                        </div>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="card">
                    <h4 class="text-xl font-bold text-gray-900 mb-6">üìà Session Statistics</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center p-4 bg-blue-50 rounded-lg">
                            <div class="text-2xl font-bold text-blue-900" id="testsCreated">0</div>
                            <div class="text-blue-700 text-sm">Tests Created</div>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <div class="text-2xl font-bold text-green-900" id="testsExecuted">0</div>
                            <div class="text-green-700 text-sm">Tests Executed</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let currentSessionId = null;
        let executionInterval = null;
        let sessionStats = { created: 0, executed: 0, successful: 0 };

        // Check backend connection
        async function checkBackendConnection() {
            try {
                const response = await fetch('http://localhost:8000/health');
                const data = await response.json();
                
                document.getElementById('connectionStatus').innerHTML = `
                    <div class="w-4 h-4 bg-green-400 rounded-full"></div>
                    <span class="text-sm font-medium">Connected & Ready</span>
                `;
                
                updateSystemStatus(true, data);
                return true;
            } catch (error) {
                document.getElementById('connectionStatus').innerHTML = `
                    <div class="w-4 h-4 bg-red-400 rounded-full"></div>
                    <span class="text-sm font-medium">Disconnected</span>
                `;
                
                updateSystemStatus(false);
                return false;
            }
        }

        function updateSystemStatus(connected, data = null) {
            const statusElements = [
                { name: "Backend API", status: connected ? "Online" : "Offline", color: connected ? "green" : "red" },
                { name: "AI Engine", status: connected ? "Ready" : "Offline", color: connected ? "green" : "red" },
                { name: "Browser Engine", status: connected ? "Ready" : "Offline", color: connected ? "green" : "red" }
            ];
            
            const statusHtml = statusElements.map(item => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <span class="font-medium text-gray-700">${item.name}</span>
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-${item.color}-500 rounded-full"></div>
                        <span class="text-sm text-${item.color}-600 font-medium">${item.status}</span>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('systemStatus').innerHTML = statusHtml;
        }

        function updateSessionStats() {
            document.getElementById('testsCreated').textContent = sessionStats.created;
            document.getElementById('testsExecuted').textContent = sessionStats.executed;
        }

        // Example button functionality
        document.querySelectorAll('.example-btn').forEach(button => {
            button.addEventListener('click', () => {
                document.getElementById('websiteUrl').value = button.dataset.url;
                document.getElementById('testPrompt').value = button.dataset.prompt;
                
                // Add visual feedback
                button.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    button.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        button.style.transform = 'scale(1)';
                    }, 150);
                }, 150);
            });
        });

        // Form submission
        document.getElementById('testForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const websiteUrl = document.getElementById('websiteUrl').value;
            const testPrompt = document.getElementById('testPrompt').value;
            
            if (!websiteUrl || !testPrompt) {
                alert('Please fill in all required fields');
                return;
            }

            // Check backend connection first
            const isConnected = await checkBackendConnection();
            if (!isConnected) {
                alert('Backend server is not running. Please start it first.');
                return;
            }

            await executeCompleteTest(websiteUrl, testPrompt);
        });

        async function executeCompleteTest(websiteUrl, testPrompt) {
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const submitSpinner = document.getElementById('submitSpinner');
            
            try {
                // Disable form and show loading
                submitBtn.disabled = true;
                submitText.textContent = 'üß† AI Analyzing Your Prompt...';
                submitSpinner.classList.remove('hidden');
                
                // Create test
                const createResponse = await fetch('http://localhost:8000/api/tests/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        website_url: websiteUrl,
                        prompt: testPrompt
                    })
                });
                
                if (!createResponse.ok) {
                    throw new Error(`Failed to create test: ${createResponse.statusText}`);
                }
                
                const testData = await createResponse.json();
                currentSessionId = testData.session_id;
                sessionStats.created++;
                updateSessionStats();
                
                submitText.textContent = 'üìã Generating Intelligent Action Plan...';
                
                // Show action plan
                showActionPlan(testData.action_plan);
                
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                submitText.textContent = 'üöÄ Launching Browser & Starting Execution...';
                
                // Execute test
                const executeResponse = await fetch('http://localhost:8000/api/tests/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        session_id: currentSessionId
                    })
                });
                
                if (!executeResponse.ok) {
                    throw new Error(`Failed to execute test: ${executeResponse.statusText}`);
                }
                
                sessionStats.executed++;
                updateSessionStats();
                
                submitText.textContent = '‚ö° Browser Opening - Executing Actions...';
                
                // Show execution monitoring
                showExecutionMonitoring(testData.action_plan);
                
                // Start monitoring execution
                startExecutionMonitoring();
                
            } catch (error) {
                alert(`Error: ${error.message}`);
                resetForm();
            }
        }

        function showActionPlan(actionPlan) {
            const actionPlanSection = document.getElementById('actionPlanSection');
            const actionPlanContent = document.getElementById('actionPlanContent');
            
            actionPlanContent.innerHTML = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="font-bold text-blue-900 text-xl">üß† AI Analysis Complete</div>
                            <div class="text-blue-700 font-semibold">Confidence: ${Math.round(actionPlan.confidence * 100)}%</div>
                        </div>
                        <div class="text-blue-700 mb-3">
                            üìã ${actionPlan.actions.length} actions planned ‚Ä¢ ‚è±Ô∏è Estimated duration: ${actionPlan.estimated_duration}s
                        </div>
                        <div class="text-blue-600 italic text-sm">
                            ${actionPlan.reasoning}
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        ${actionPlan.actions.map((action, index) => `
                            <div id="plan-action-${index}" class="action-item flex items-center space-x-4 p-5 bg-gray-50 rounded-xl border-2 border-gray-200">
                                <div class="w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center text-lg font-bold">
                                    ${index + 1}
                                </div>
                                <div class="flex-1">
                                    <div class="font-semibold text-gray-900 text-lg">${action.description}</div>
                                    <div class="text-gray-600 mt-1">
                                        <span class="inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium mr-2">${action.type}</span>
                                        ${action.target ? `Target: ${action.target}` : ''}
                                        ${action.value ? ` | Value: "${action.value}"` : ''}
                                    </div>
                                </div>
                                <div id="plan-status-${index}" class="text-2xl text-gray-400">‚è≥</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            actionPlanSection.classList.remove('hidden');
            actionPlanSection.classList.add('fade-in');
            actionPlanSection.scrollIntoView({ behavior: 'smooth' });
        }

        function showExecutionMonitoring(actionPlan) {
            const executionSection = document.getElementById('executionSection');
            const executionContent = document.getElementById('executionContent');
            
            executionContent.innerHTML = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="font-bold text-green-900 text-xl">‚ö° Live Execution Started</div>
                            <div class="text-green-700 font-semibold">üåê Browser Opening...</div>
                        </div>
                        <div class="progress-bar mb-3">
                            <div id="execution-progress" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="text-green-600 font-medium">
                            <span id="current-action-text">üöÄ Initializing browser automation...</span>
                        </div>
                    </div>
                    
                    <div id="execution-actions" class="space-y-3">
                        ${actionPlan.actions.map((action, index) => `
                            <div id="exec-action-${index}" class="action-item flex items-center space-x-4 p-5 bg-gray-50 rounded-xl border-2 border-gray-200">
                                <div class="w-10 h-10 bg-gray-400 text-white rounded-full flex items-center justify-center text-lg font-bold">
                                    ${index + 1}
                                </div>
                                <div class="flex-1">
                                    <div class="font-semibold text-gray-900 text-lg">${action.description}</div>
                                    <div class="text-gray-600">${action.type}</div>
                                </div>
                                <div id="exec-status-${index}" class="text-2xl text-gray-400">‚è≥</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            executionSection.classList.remove('hidden');
            executionSection.classList.add('fade-in');
            executionSection.scrollIntoView({ behavior: 'smooth' });
        }

        function startExecutionMonitoring() {
            const totalActions = document.querySelectorAll('[id^="exec-action-"]').length;
            
            executionInterval = setInterval(async () => {
                try {
                    const response = await fetch(`http://localhost:8000/api/tests/${currentSessionId}`);
                    const data = await response.json();
                    
                    if (data.execution_status && data.execution_status.current_action !== undefined) {
                        const currentAction = data.execution_status.current_action;
                        const progress = data.execution_status.progress || 0;
                        
                        // Update progress bar
                        document.getElementById('execution-progress').style.width = `${progress}%`;
                        document.getElementById('current-action-text').textContent = 
                            `üîÑ Executing action ${currentAction + 1} of ${totalActions} - Browser is performing actions...`;
                        
                        // Update action statuses
                        for (let i = 0; i < currentAction; i++) {
                            const statusElement = document.getElementById(`exec-status-${i}`);
                            const actionElement = document.getElementById(`exec-action-${i}`);
                            if (statusElement && actionElement) {
                                statusElement.innerHTML = '‚úÖ';
                                statusElement.className = 'text-2xl text-green-500';
                                actionElement.className = 'action-item completed flex items-center space-x-4 p-5 rounded-xl border-2';
                            }
                        }
                        
                        // Highlight current action
                        const currentActionElement = document.getElementById(`exec-action-${currentAction}`);
                        const currentStatusElement = document.getElementById(`exec-status-${currentAction}`);
                        if (currentActionElement && currentStatusElement) {
                            currentActionElement.className = 'action-item executing flex items-center space-x-4 p-5 rounded-xl border-2';
                            currentStatusElement.innerHTML = '<div class="spinner w-6 h-6"></div>';
                            currentStatusElement.className = 'text-blue-500';
                        }
                    }
                    
                    // Check if completed
                    if (data.session.status === 'completed' || data.session.status === 'failed') {
                        clearInterval(executionInterval);
                        
                        // Update final progress
                        document.getElementById('execution-progress').style.width = '100%';
                        document.getElementById('current-action-text').textContent = 
                            data.session.status === 'completed' ? 
                            'üéâ All actions completed successfully! Browser automation finished.' : 
                            '‚ùå Execution failed - Check results below';
                        
                        // Mark final action
                        const lastActionIndex = totalActions - 1;
                        const lastStatusElement = document.getElementById(`exec-status-${lastActionIndex}`);
                        const lastActionElement = document.getElementById(`exec-action-${lastActionIndex}`);
                        if (lastStatusElement && lastActionElement) {
                            if (data.session.status === 'completed') {
                                lastStatusElement.innerHTML = '‚úÖ';
                                lastStatusElement.className = 'text-2xl text-green-500';
                                lastActionElement.className = 'action-item completed flex items-center space-x-4 p-5 rounded-xl border-2';
                                sessionStats.successful++;
                            } else {
                                lastStatusElement.innerHTML = '‚ùå';
                                lastStatusElement.className = 'text-2xl text-red-500';
                                lastActionElement.className = 'action-item failed flex items-center space-x-4 p-5 rounded-xl border-2';
                            }
                        }
                        
                        updateSessionStats();
                        showFinalResults(data.session);
                    }
                    
                } catch (error) {
                    console.error('Error monitoring execution:', error);
                }
            }, 1000);
        }

        function showFinalResults(session) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsContent = document.getElementById('resultsContent');
            
            const isSuccess = session.status === 'completed';
            
            resultsContent.innerHTML = `
                <div class="space-y-8">
                    <div class="bg-${isSuccess ? 'green' : 'red'}-50 border-2 border-${isSuccess ? 'green' : 'red'}-200 rounded-xl p-8">
                        <div class="flex items-center space-x-4 mb-6">
                            <div class="text-${isSuccess ? 'green' : 'red'}-600 text-5xl">
                                ${isSuccess ? 'üéâ' : '‚ùå'}
                            </div>
                            <div>
                                <div class="text-${isSuccess ? 'green' : 'red'}-800 font-bold text-2xl">
                                    Test ${isSuccess ? 'Completed Successfully!' : 'Failed'}
                                </div>
                                <div class="text-${isSuccess ? 'green' : 'red'}-700 text-lg">
                                    ${session.successful_actions} successful actions, ${session.failed_actions} failed actions
                                    ${session.total_duration ? ` ‚Ä¢ Duration: ${session.total_duration}s` : ''}
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white bg-opacity-70 rounded-lg p-6">
                            <div class="text-${isSuccess ? 'green' : 'red'}-800 font-semibold text-lg mb-3">
                                ${isSuccess ? '‚ú® Complete Success!' : '‚ö†Ô∏è Execution Issues'}
                            </div>
                            <div class="text-${isSuccess ? 'green' : 'red'}-700">
                                ${isSuccess ? 
                                    'All planned actions were executed successfully. The intelligent automation system successfully interpreted your natural language prompt and converted it into precise browser automation steps that were executed on the real website.' :
                                    session.error_summary || 'Some actions failed during execution. The browser was opened and navigation was attempted, but some interactions may not have completed successfully.'
                                }
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-6 text-center">
                            <div class="text-3xl font-bold text-blue-900">${session.total_actions}</div>
                            <div class="text-blue-700 font-medium">Total Actions</div>
                        </div>
                        <div class="bg-green-50 border-2 border-green-200 rounded-xl p-6 text-center">
                            <div class="text-3xl font-bold text-green-900">${session.successful_actions}</div>
                            <div class="text-green-700 font-medium">Successful</div>
                        </div>
                        <div class="bg-orange-50 border-2 border-orange-200 rounded-xl p-6 text-center">
                            <div class="text-3xl font-bold text-orange-900">${session.failed_actions}</div>
                            <div class="text-orange-700 font-medium">Failed</div>
                        </div>
                        <div class="bg-purple-50 border-2 border-purple-200 rounded-xl p-6 text-center">
                            <div class="text-3xl font-bold text-purple-900">${session.total_duration || 0}s</div>
                            <div class="text-purple-700 font-medium">Duration</div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-8">
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="text-4xl">üöÄ</div>
                            <div class="font-bold text-indigo-900 text-2xl">Complete Project Execution Finished!</div>
                        </div>
                        <div class="text-indigo-700 text-lg leading-relaxed">
                            Your natural language prompt was successfully converted into ${session.total_actions} precise browser actions 
                            and executed ${isSuccess ? 'flawlessly' : 'with some challenges'} on the real website. This demonstrates the complete 
                            intelligent automation testing project working end-to-end with AI-driven understanding, action planning, 
                            and real browser execution.
                        </div>
                    </div>
                </div>
            `;
            
            resultsSection.classList.remove('hidden');
            resultsSection.classList.add('fade-in');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
            
            resetForm();
        }

        function resetForm() {
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const submitSpinner = document.getElementById('submitSpinner');
            
            submitBtn.disabled = false;
            submitText.textContent = 'üöÄ Launch Intelligent Test';
            submitSpinner.classList.add('hidden');
            
            if (executionInterval) {
                clearInterval(executionInterval);
                executionInterval = null;
            }
        }

        // Initialize
        checkBackendConnection();
        updateSessionStats();
        setInterval(checkBackendConnection, 30000); // Check every 30 seconds
        
        // Add some visual flair
        setTimeout(() => {
            document.querySelector('.hero-text').style.animation = 'pulse 3s ease-in-out infinite';
        }, 1000);
    </script>
</body>
</html>
